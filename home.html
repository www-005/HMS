<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistem Menaxhimi â€” Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:'Poppins',sans-serif;background:#f6f9fc;color:#0b1220;}
    .container{display:grid;grid-template-columns:260px 1fr;gap:25px;max-width:1100px;margin:auto;padding:30px; transition: all 0.3s ease;}
    .sidebar{
      background:white;border-radius:14px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,0.1);
      transition: left 0.3s ease;
      position: relative;
    }
    .sidebar.active{
      left: 0;
    }
    .nav button{width:100%;background:none;border:none;padding:12px;border-radius:10px;text-align:left;cursor:pointer;font-size:15px;}
    .nav button.active{background:#007bff;color:white;font-weight:bold;}
    .main{background:white;border-radius:14px;padding:20px;box-shadow:0 6px 20px rgba(0,0,0,0.1); transition: margin-left 0.3s ease;}
    input,textarea{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc;}
    .add-btn{background:#28a745;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;}
    .task{background:#f2f5f9;padding:10px;border-radius:10px;margin:8px 0;display:flex;justify-content:space-between;align-items:center;}
    .task button{background:#dc3545;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;}

    /* ================= BURGER ================= */
    .hamburger {
      display: flex;
      flex-direction: column;
      cursor: pointer;
      gap: 5px;
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 200;
    }
    .hamburger div {
      width: 30px;
      height: 3px;
      background-color: #0b1220;
      border-radius: 2px;
      transition: all 0.3s ease;
    }
    .hamburger.active div:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    .hamburger.active div:nth-child(2) {
      opacity: 0;
    }
    .hamburger.active div:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }

    @media (max-width: 768px) {
      .container { grid-template-columns: 1fr; }
      .sidebar { position: fixed; left: -300px; top:0; height:100%; width:260px; z-index: 100; }
      .sidebar.active { left:0; }
      .main { padding-top: 70px; }
    }
  </style>
</head>
<body>
  <!-- HAMBURGER -->
  <div class="hamburger" id="hamburger">
    <div></div>
    <div></div>
    <div></div>
  </div>

  <div class="container">
    <aside class="sidebar" id="sidebar">
      <h2>Sistem Menaxhimi</h2>
      <p id="userEmail" style="color:gray;font-size:13px;">Ngarkim...</p>
      <div class="nav">
        <button id="menu-detyrat" class="active" onclick="showPanel('detyrat')">Detyrat</button>
        <button id="menu-provimet" onclick="showPanel('provimet')">Provimet</button>
        <button id="menu-projektet" onclick="showPanel('projektet')">Projektet</button>
      </div>
      <button id="logoutBtn" style="margin-top:20px;padding:10px;border:none;background:#f1f3f5;border-radius:10px;width:100%;">ShkyÃ§u</button>
    </aside>

    <main class="main">
      <!-- Detyrat -->
      <section id="detyrat" class="panel active">
        <h3>ðŸ“˜ Detyrat e ShtÃ«pisÃ«</h3>
        <input id="subjectHomework" placeholder="Emri i lÃ«ndÃ«s">
        <textarea id="descHomework" placeholder="PÃ«rshkrimi"></textarea>
        <input id="dateHomework" type="date">
        <button class="add-btn" onclick="addTask('detyrat')">Shto DetyrÃ«</button>
        <div id="listHomework"></div>
      </section>

      <!-- Provimet -->
      <section id="provimet" class="panel" style="display:none;">
        <h3>ðŸ§ª Provimet</h3>
        <input id="subjectExam" placeholder="Emri i lÃ«ndÃ«s">
        <textarea id="descExam" placeholder="PÃ«rshkrimi"></textarea>
        <input id="dateExam" type="date">
        <button class="add-btn" onclick="addTask('provimet')">Shto Provim</button>
        <div id="listExam"></div>
      </section>

      <!-- Projektet -->
      <section id="projektet" class="panel" style="display:none;">
        <h3>ðŸ’¡ Projektet</h3>
        <input id="subjectProject" placeholder="Emri i projektit">
        <textarea id="descProject" placeholder="PÃ«rshkrimi"></textarea>
        <input id="dateProject" type="date">
        <button class="add-btn" onclick="addTask('projektet')">Shto Projekt</button>
        <div id="listProject"></div>
      </section>
    </main>
  </div>

  <!-- Form fshehur pÃ«r dÃ«rgim email -->
  <form id="emailForm" action="https://formspree.io/f/xanlnqzq" method="POST" style="display:none;">
    <input type="email" name="email" id="emailToSend">
    <input type="text" name="type" id="typeToSend">
    <input type="text" name="subject" id="subjectToSend">
    <input type="text" name="description" id="descToSend">
    <input type="date" name="date" id="dateToSend">
    <button type="submit" id="sendBtn">Send</button>
  </form>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDzLA2BtSeRukeyHaE5Sb-VGK1aSywrBv4",
      authDomain: "hwms-c37e9.firebaseapp.com",
      projectId: "hwms-c37e9",
      storageBucket: "hwms-c37e9.firebasestorage.app",
      messagingSenderId: "723888101927",
      appId: "1:723888101927:web:ab140d13119fde4f7acc02",
      measurementId: "G-16ZKY1MHC3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app, "https://hwms-c37e9-default-rtdb.europe-west1.firebasedatabase.app");
    const auth = getAuth(app);

    let currentUser = null;

    // kontrollo login
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html";
      } else {
        currentUser = user;
        document.getElementById("userEmail").textContent = user.email;
        loadTasks("detyrat", "listHomework");
        loadTasks("provimet", "listExam");
        loadTasks("projektet", "listProject");
      }
    });

    // shfaq panelin e duhur
    window.showPanel = function(id){
      document.querySelectorAll(".panel").forEach(p=>p.style.display="none");
      document.getElementById(id).style.display="block";
      document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
      document.getElementById("menu-"+id).classList.add("active");
    }

    window.addTask = function(type){
      if(!currentUser){ alert("Prit derisa tÃ« ngarkohet pÃ«rdoruesi!"); return; }

      const map = {
        detyrat: {s:"subjectHomework", d:"descHomework", da:"dateHomework", list:"listHomework"},
        provimet: {s:"subjectExam", d:"descExam", da:"dateExam", list:"listExam"},
        projektet: {s:"subjectProject", d:"descProject", da:"dateProject", list:"listProject"}
      }[type];

      const subject = document.getElementById(map.s).value.trim();
      const desc = document.getElementById(map.d).value.trim();
      const date = document.getElementById(map.da).value;

      if(!subject || !desc || !date){ alert("PlotÃ«so tÃ« gjitha fushat!"); return; }

      // Shto nÃ« Firebase
      push(ref(db, `${type}/${currentUser.uid}`), {subject, desc, date})
      .then(()=>{
        document.getElementById(map.s).value="";
        document.getElementById(map.d).value="";
        document.getElementById(map.da).value="";

        // DÃ«rgo email me Formspree
        document.getElementById('emailToSend').value = currentUser.email;
        document.getElementById('typeToSend').value = type;
        document.getElementById('subjectToSend').value = subject;
        document.getElementById('descToSend').value = desc;
        document.getElementById('dateToSend').value = date;

        document.getElementById('sendBtn').click();
      })
      .catch(e => alert(e.message));
    }

    function loadTasks(type,listId){
      const div=document.getElementById(listId);
      onValue(ref(db,`${type}/${currentUser.uid}`),snap=>{
        div.innerHTML="";
        snap.forEach(child=>{
          const data=child.val();
          const el=document.createElement("div");
          el.className="task";
          el.innerHTML=`<div><b>${data.subject}</b><br>${data.desc}<br><small>${data.date}</small></div><button onclick="deleteTask('${type}','${child.key}')">Perfundo</button>`;
          div.appendChild(el);
        });
      });
    }

    window.deleteTask=function(type,key){ remove(ref(db,`${type}/${currentUser.uid}/${key}`)); }

    document.getElementById("logoutBtn").addEventListener("click",()=>{signOut(auth).then(()=>window.location.href="index.html")});

    // ================= BURGER MENU =================
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');

    hamburger.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      hamburger.classList.toggle('active');
    });
  </script>
</body>
</html>
